{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="fas fa-chart-bar"></i> Charts & Visualizations</h2>
        <hr>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Expenses by Category</h5>
            </div>
            <div class="card-body">
                <div id="expenses-chart"></div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Income vs Expenses</h5>
            </div>
            <div class="card-body">
                <div id="income-expense-chart"></div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fetch chart data
    fetch('/api/chart-data')
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                document.getElementById('expenses-chart').innerHTML = 
                    '<p class="text-muted">' + data.error + '</p>';
                document.getElementById('income-expense-chart').innerHTML = 
                    '<p class="text-muted">' + data.error + '</p>';
                return;
            }
            
            // Render expenses chart
            if (data.expenses_by_category) {
                const expensesData = JSON.parse(data.expenses_by_category);
                Plotly.newPlot('expenses-chart', expensesData.data, expensesData.layout);
            }
            
            // Render income vs expenses chart
            if (data.income_vs_expenses) {
                const incomeExpenseData = JSON.parse(data.income_vs_expenses);
                Plotly.newPlot('income-expense-chart', incomeExpenseData.data, incomeExpenseData.layout);
            }
        })
        .catch(error => {
            console.error('Error fetching chart data:', error);
            document.getElementById('expenses-chart').innerHTML = 
                '<p class="text-muted">Error loading charts</p>';
            document.getElementById('income-expense-chart').innerHTML = 
                '<p class="text-muted">Error loading charts</p>';
        });
});
</script>
{% endblock %}